<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>나의 아픈 곳은? - AI 건강 가이드</title>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&display=swap');

        :root {
            --primary-color: #007bff;
            --light-gray: #f8f9fa;
            --dark-gray: #343a40;
            --border-color: #dee2e6;
            --selected-color: #28a745;
        }

        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: var(--light-gray);
            color: var(--dark-gray);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
        }

        /* --- 데스크탑용 2단 레이아웃 --- */
        .container {
            display: flex;
            gap: 30px;
            background-color: white;
            padding: 40px;
            border-radius: 16px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 1100px; /* 데스크탑에 맞게 너비 확장 */
            min-height: 700px;
        }

        .left-panel {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border-right: 1px solid var(--border-color);
            padding-right: 30px;
        }
        
        #body-map-container {
            width: 100%;
            max-width: 400px; /* SVG 최대 너비 제한 */
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        #body-map-container object {
            width: 100%;
            height: auto;
            max-height: 600px; /* SVG 최대 높이 제한으로 스크롤 방지 */
        }

        .right-panel {
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        
        /* --- 기본 컴포넌트 스타일 --- */
        h1 {
            text-align: center;
            color: var(--primary-color);
            margin-top: 0;
            margin-bottom: 5px;
        }

        h1 .subtitle {
            display: block;
            font-size: 1rem;
            color: #6c757d;
            font-weight: 400;
        }

        h2 {
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 10px;
            margin-top: 20px;
            margin-bottom: 20px;
            font-size: 1.4rem;
            text-align: left;
        }

        .disclaimer {
            background-color: #fff3cd;
            border: 1px solid #ffeeba;
            border-radius: 8px;
            padding: 15px;
            font-size: 0.9rem;
            text-align: center;
            margin-bottom: 30px;
        }

        .options {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
            justify-content: flex-start;
        }

        .btn {
            padding: 12px 20px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background-color: white;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.2s ease-in-out;
            font-family: 'Noto Sans KR', sans-serif;
            min-width: 80px;
            text-align: center;
        }

        .btn:hover {
            background-color: #e9ecef;
            border-color: #adb5bd;
        }

        .btn.selected {
            background-color: var(--selected-color);
            color: white;
            border-color: var(--selected-color);
            font-weight: 700;
        }

        .btn-next {
            width: 100%;
            background-color: var(--primary-color);
            color: white;
            font-weight: 700;
            font-size: 1.1rem;
            margin-top: auto; /* 버튼을 항상 아래에 위치시킴 */
            padding: 15px;
        }

        .btn-next:hover {
            opacity: 0.9;
            background-color: var(--primary-color);
        }

        textarea {
            width: 100%;
            height: 80px;
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-family: 'Noto Sans KR', sans-serif;
            font-size: 1rem;
            resize: vertical;
            margin-bottom: 20px;
        }

        .hidden {
            display: none;
        }

        .result-box {
            background-color: var(--light-gray);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }
    </style>
</head>

<body>
    <div class="container">
        <!-- 왼쪽 패널: 신체 지도 -->
        <div id="left-panel" class="left-panel hidden">
            <div id="body-map-container">
                <object type="image/svg+xml" data="front-fulld-body.svg" id="body-svg">
                    <img src="front-fulld-body.png" alt="인체 상세 이미지">
                </object>
            </div>
        </div>

        <!-- 오른쪽 패널: 단계별 질문 -->
        <div class="right-panel">
            <section id="step1_gender">
                <h1>나의 아픈 곳은? <span class="subtitle">AI 건강 가이드</span></h1>
                <p class="disclaimer">
                    ⚠️ <strong>중요 안내:</strong> 본 프로그램은 의료적 진단이 아니며, 참고용으로만 사용해야 합니다.
                </p>
                <h2>1단계: 성별을 선택하세요</h2>
                <div class="options">
                    <button class="btn gender-btn" data-gender="male">남성</button>
                    <button class="btn gender-btn" data-gender="female">여성</button>
                </div>
            </section>

            <section id="step2_bodypart" class="hidden">
                <h2>2단계: 아픈 부위를 선택하세요</h2>
                <p>왼쪽 신체 지도에서 아픈 부위에 마우스를 올리거나 클릭하세요.</p>
            </section>

            <section id="step3_symptoms" class="hidden">
                <h2>3단계: 증상을 모두 선택하세요 🤒</h2>
                <div id="symptom-options" class="options"></div>
                <textarea id="symptom-details" placeholder="선택지에 없는 증상이나 더 자세한 내용을 입력하세요."></textarea>
                <button id="to-step4-btn" class="btn btn-next">다음 단계로</button>
            </section>

            <section id="step4_conditions" class="hidden">
                <h2>4단계: 증상이 나타나기 전 상황을 알려주세요 ✍️</h2>
                <div class="options">
                    <button class="btn condition-btn" data-condition="수면 부족">수면 부족</button>
                    <button class="btn condition-btn" data-condition="스트레스">스트레스</button>
                    <button class="btn condition-btn" data-condition="과식">과식</button>
                    <button class="btn condition-btn" data-condition="과음">과음</button>
                    <button class="btn condition-btn" data-condition="운동 후">운동/활동 후</button>
                    <button class="btn condition-btn" data-condition="자고 일어난 후">자고 일어난 후</button>
                </div>
                <button id="get-result-btn" class="btn btn-next">AI 분석 결과 보기</button>
            </section>

            <section id="result" class="hidden">
                <h2>AI 분석 및 맞춤형 조언</h2>
                <div id="result-content" class="result-box"></div>
                <button id="restart-btn" class="btn btn-next">처음부터 다시 시작</button>
            </section>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- DOM 요소 선택 ---
            const leftPanel = document.getElementById('left-panel');
            const steps = {
                gender: document.getElementById('step1_gender'),
                bodyPart: document.getElementById('step2_bodypart'),
                symptoms: document.getElementById('step3_symptoms'),
                conditions: document.getElementById('step4_conditions'),
                result: document.getElementById('result')
            };
            const bodyObject = document.getElementById('body-svg');
            const symptomOptionsContainer = document.getElementById('symptom-options');
            const resultContent = document.getElementById('result-content');

            // --- 데이터 및 설정 ---
            let userSelections = { gender: null, part: null, symptoms: [], conditions: [] };
            const symptomsData = {
                // SVG 파일 내부의 path에 부여된 클래스 이름과 일치해야 합니다.
                head: ['두통', '어지럼증', '눈 통증', '코막힘', '목아픔'],
                torso: ['가슴 통증', '복통', '속쓰림', '등 통증', '허리 통증'],
                'arm-right': ['오른쪽 어깨 결림', '오른쪽 팔꿈치 통증', '오른쪽 손목/손가락 저림'],
                'arm-left': ['왼쪽 어깨 결림', '왼쪽 팔꿈치 통증', '왼쪽 손목/손가락 저림'],
                'leg-right': ['오른쪽 고관절 통증', '오른쪽 무릎 통증', '오른쪽 발목/발바닥 통증'],
                'leg-left': ['왼쪽 고관절 통증', '왼쪽 무릎 통증', '왼쪽 발목/발바닥 통증']
            };

            // --- 이벤트 리스너 설정 ---

            // 1단계: 성별 선택
            document.querySelectorAll('.gender-btn').forEach(button => {
                button.addEventListener('click', () => {
                    userSelections.gender = button.dataset.gender;
                    steps.gender.classList.add('hidden');
                    leftPanel.classList.remove('hidden'); // 왼쪽 패널(SVG) 보이기
                    steps.bodyPart.classList.remove('hidden');
                });
            });

            // SVG가 로드되면 클릭 이벤트 설정
            bodyObject.addEventListener('load', setupSvgEventListeners);

            // 3단계 -> 4단계
            document.getElementById('to-step4-btn').addEventListener('click', handleSymptomSubmission);
            
            // 4단계 -> 결과
            document.getElementById('get-result-btn').addEventListener('click', handleConditionSubmission);

            // 재시작
            document.getElementById('restart-btn').addEventListener('click', restart);

            // --- 핵심 함수 ---

            function setupSvgEventListeners() {
                const svgDoc = bodyObject.contentDocument;
                if (!svgDoc) {
                    console.error("SVG 문서를 찾을 수 없습니다. 로컬 서버에서 실행하고 있는지 확인하세요.");
                    return;
                }

                // 상세 지도의 클릭 가능한 모든 부위를 선택합니다.
                const clickableParts = svgDoc.querySelectorAll('.head, .torso, .arm-right, .arm-left, .leg-right, .leg-left');
                
                clickableParts.forEach(part => {
                    part.addEventListener('click', (e) => {
                        const partName = Array.from(e.currentTarget.classList).find(c => symptomsData.hasOwnProperty(c));
                        
                        if (!partName) return;

                        userSelections.part = partName;
                        
                        populateSymptoms(partName);
                        steps.bodyPart.classList.add('hidden');
                        steps.symptoms.classList.remove('hidden');
                    });
                });
            }

            function populateSymptoms(partName) {
                symptomOptionsContainer.innerHTML = '';
                const symptoms = symptomsData[partName] || [];
                symptoms.forEach(symptom => {
                    const button = document.createElement('button');
                    button.className = 'btn symptom-btn';
                    button.dataset.symptom = symptom;
                    button.textContent = symptom;
                    button.addEventListener('click', () => button.classList.toggle('selected'));
                    symptomOptionsContainer.appendChild(button);
                });
            }

            function handleSymptomSubmission() {
                userSelections.symptoms = Array.from(document.querySelectorAll('.symptom-btn.selected')).map(btn => btn.dataset.symptom);
                const details = document.getElementById('symptom-details').value;
                if (details) userSelections.symptoms.push(`(상세: ${details})`);

                if (userSelections.symptoms.length === 0) {
                    alert('증상을 하나 이상 선택해주세요.');
                    return;
                }
                
                steps.symptoms.classList.add('hidden');
                steps.conditions.classList.remove('hidden');
            }
            
            function handleConditionSubmission() {
                 userSelections.conditions = Array.from(document.querySelectorAll('.condition-btn.selected')).map(btn => btn.dataset.condition);
                 analyzeAndShowResult();
                 steps.conditions.classList.add('hidden');
                 steps.result.classList.remove('hidden');
            }

            function analyzeAndShowResult() {
                const { part, symptoms, gender, conditions } = userSelections;
                const genderText = gender === 'male' ? '남성' : '여성';
                let html = `<h3>분석 결과 (예시)</h3>
                            <p><strong>성별:</strong> ${genderText}</p>
                            <p><strong>아픈 부위:</strong> ${part}</p>
                            <p><strong>증상:</strong> ${symptoms.join(', ')}</p>
                            <p><strong>상황:</strong> ${conditions.join(', ')}</p>
                            <p class="warning">이 결과는 예시입니다. 실제 분석 로직을 추가해야 합니다.</p>`;
                resultContent.innerHTML = html;
            }

            function restart() {
                userSelections = { gender: null, part: null, symptoms: [], conditions: [] };
                document.querySelectorAll('.btn.selected').forEach(btn => btn.classList.remove('selected'));
                document.getElementById('symptom-details').value = '';
                
                Object.values(steps).forEach(step => step.classList.add('hidden'));
                leftPanel.classList.add('hidden');
                steps.gender.classList.remove('hidden');
            }
            
            // 조건 버튼 토글 기능
            document.querySelectorAll('.condition-btn').forEach(button => {
                button.addEventListener('click', () => button.classList.toggle('selected'));
            });
        });
    </script>
</body>

</html>
